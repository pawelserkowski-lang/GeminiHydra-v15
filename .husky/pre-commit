#!/bin/sh

# Jaskier Shared Pattern -- pre-commit hook
# Frontend: lint-staged (biome check + format) + TypeScript check
# Backend: cargo check (only if .rs files staged)

# Run lint-staged on staged frontend files
npx lint-staged
if [ $? -ne 0 ]; then
  echo "lint-staged failed. Fix errors before committing."
  exit 1
fi

# Frontend TypeScript check
npx tsc --noEmit --skipLibCheck
if [ $? -ne 0 ]; then
  echo "TypeScript check failed. Fix errors before committing."
  exit 1
fi

# Backend check (only if .rs files staged)
if git diff --cached --name-only | grep -q '\.rs$'; then
  (cd backend && cargo check)
  if [ $? -ne 0 ]; then
    echo "Cargo check failed. Fix errors before committing."
    exit 1
  fi
fi
